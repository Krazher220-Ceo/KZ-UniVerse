// Telegram Bot –¥–ª—è KZ UniVerse
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: node bot.js

// –û—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É SSL –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ production!)
process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';

const TelegramBot = require('node-telegram-bot-api');
const fetch = require('node-fetch');

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
const BOT_TOKEN = process.env.TELEGRAM_BOT_TOKEN || '8480152282:AAHZPfFdnS9GtSRfEiGtQyF3euzU0F43ZrI';
const GEMINI_API_KEY = process.env.GEMINI_API_KEY || 'AQ.Ab8RN6I6fN37ba1DTn4XeUB4uw3cwBJAuce0U6wh9MwjXypUbA';
const API_URL = process.env.API_URL || 'https://kz-universe.vercel.app';

// –ü–æ–ª–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤
const UNIVERSITIES_DB = [
  {
    id: 'nu',
    shortName: 'NU',
    name: 'Nazarbayev University',
    nameRu: '–ù–∞–∑–∞—Ä–±–∞–µ–≤ –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
    rating: 4.9,
    worldRank: 295,
    city: '–ê—Å—Ç–∞–Ω–∞',
    founded: 2010,
    students: 6000,
    type: 'national',
    tuition: '7,000 - 9,000 USD/–≥–æ–¥',
    website: 'https://nu.edu.kz',
    description: '–ü–µ—Ä–≤—ã–π –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –í—Ö–æ–¥–∏—Ç –≤ —Ç–æ–ø-300 –ª—É—á—à–∏—Ö —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –º–∏—Ä–∞ (THE, QS). –í—Å–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ. –ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ —Å Cambridge, Stanford, MIT.',
    programs: ['Computer Science', 'Engineering', 'Business', 'Medicine', 'Law'],
    achievements: ['‚Ññ1 –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ', '–¢–æ–ø-300 –º–∏—Ä–æ–≤—ã—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤', '100% –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º', '98% —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ'],
    contacts: { phone: '+7 (7172) 70-66-88', email: 'nu@nu.edu.kz' }
  },
  {
    id: 'kaznu',
    shortName: '–ö–∞–∑–ù–£',
    name: 'Al-Farabi Kazakh National University',
    nameRu: '–ö–∞–∑–ù–£ –∏–º. –∞–ª—å-–§–∞—Ä–∞–±–∏',
    rating: 4.7,
    worldRank: 165,
    city: '–ê–ª–º–∞—Ç—ã',
    founded: 1934,
    students: 20000,
    type: 'state',
    tuition: '600,000 - 1,800,000 ‚Ç∏/–≥–æ–¥',
    website: 'https://kaznu.kz',
    description: '–°—Ç–∞—Ä–µ–π—à–∏–π –∏ –∫—Ä—É–ø–Ω–µ–π—à–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. 165 –º–µ—Å—Ç–æ –≤ QS World Rankings. 17 —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–æ–≤, –±–æ–ª–µ–µ 200 –ø—Ä–æ–≥—Ä–∞–º–º. –ë–æ–ª–µ–µ 1000 –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã—Ö –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤.',
    programs: ['IT', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–§–∏–∑–∏–∫–∞', '–•–∏–º–∏—è', '–≠–∫–æ–Ω–æ–º–∏–∫–∞', '–ü—Ä–∞–≤–æ', '–ñ—É—Ä–Ω–∞–ª–∏—Å—Ç–∏–∫–∞'],
    achievements: ['165 –º–µ—Å—Ç–æ QS', '–ö—Ä—É–ø–Ω–µ–π—à–∏–π –≤—É–∑ –†–ö', '20,000+ —Å—Ç—É–¥–µ–Ω—Ç–æ–≤', '90% —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ'],
    contacts: { phone: '+7 (727) 377-33-30', email: 'admission@kaznu.kz' }
  },
  {
    id: 'aitu',
    shortName: 'AITU',
    name: 'Astana IT University',
    nameRu: '–ê—Å—Ç–∞–Ω–∞ IT –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
    rating: 4.6,
    city: '–ê—Å—Ç–∞–Ω–∞',
    founded: 2017,
    students: 3500,
    type: 'state',
    tuition: '1,800,000 - 2,200,000 ‚Ç∏/–≥–æ–¥',
    website: 'https://aitu.edu.kz',
    description: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ —Å Google, Microsoft, AWS. –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏ AI –∏ Data Science. 99% —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤.',
    programs: ['AI', 'Data Science', 'Cybersecurity', 'Software Engineering', 'Big Data'],
    achievements: ['–¢–æ–ø IT-–≤—É–∑ –†–ö', '–ü–∞—Ä—Ç–Ω–µ—Ä Google/Microsoft', '99% —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ', '–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–∞–º–ø—É—Å'],
    contacts: { phone: '+7 (7172) 64-58-58', email: 'info@aitu.edu.kz' }
  },
  {
    id: 'kbtu',
    shortName: '–ö–ë–¢–£',
    name: 'Kazakh-British Technical University',
    nameRu: '–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–æ-–ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–π –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
    rating: 4.5,
    worldRank: 401,
    city: '–ê–ª–º–∞—Ç—ã',
    founded: 2001,
    students: 5500,
    type: 'state',
    tuition: '1,500,000 - 2,500,000 ‚Ç∏/–≥–æ–¥',
    website: 'https://kbtu.edu.kz',
    description: '–í–µ–¥—É—â–∏–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Å –±—Ä–∏—Ç–∞–Ω—Å–∫–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏. –ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ —Å Heriot-Watt University. –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –Ω–µ—Ñ—Ç–µ–≥–∞–∑–æ–≤–æ–π –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –∏ IT.',
    programs: ['Petroleum Engineering', 'IT', 'Economics', 'Geology', 'Chemical Engineering'],
    achievements: ['–î–≤–æ–π–Ω—ã–µ –¥–∏–ø–ª–æ–º—ã UK', 'ABET –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è', '95% —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ'],
    contacts: { phone: '+7 (727) 355-24-83', email: 'admission@kbtu.kz' }
  },
  {
    id: 'kimep',
    shortName: 'KIMEP',
    name: 'KIMEP University',
    nameRu: '–ö–ò–ú–≠–ü –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç',
    rating: 4.6,
    worldRank: 601,
    city: '–ê–ª–º–∞—Ç—ã',
    founded: 1992,
    students: 4500,
    type: 'private',
    tuition: '2,200,000 - 3,500,000 ‚Ç∏/–≥–æ–¥',
    website: 'https://kimep.kz',
    description: '–õ—É—á—à–∞—è –±–∏–∑–Ω–µ—Å-—à–∫–æ–ª–∞ –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –ê–∑–∏–∏ —Å –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–µ–π AACSB. 100% –ø—Ä–æ–≥—Ä–∞–º–º –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º. –ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ —Å 100+ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞–º–∏ –º–∏—Ä–∞.',
    programs: ['Business Administration', 'Finance', 'Marketing', 'Law', 'Media'],
    achievements: ['AACSB –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏—è', '100% –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º', '–¢–æ–ø –±–∏–∑–Ω–µ—Å-—à–∫–æ–ª–∞ –¶–ê'],
    contacts: { phone: '+7 (727) 270-42-52', email: 'admission@kimep.kz' }
  },
  {
    id: 'sdu',
    shortName: 'SDU',
    name: 'Suleyman Demirel University',
    nameRu: '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –°—É–ª–µ–π–º–∞–Ω–∞ –î–µ–º–∏—Ä–µ–ª—è',
    rating: 4.4,
    worldRank: 751,
    city: '–ê–ª–º–∞—Ç—ã',
    founded: 1996,
    students: 7000,
    type: 'private',
    tuition: '1,400,000 - 2,800,000 ‚Ç∏/–≥–æ–¥',
    website: 'https://sdu.edu.kz',
    description: '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Å —Ç—É—Ä–µ—Ü–∫–∏–º–∏ —Ç—Ä–∞–¥–∏—Ü–∏—è–º–∏. –°–∏–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã –ø–æ –º–µ–¥–∏—Ü–∏–Ω–µ, –∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –∏ –≥—É–º–∞–Ω–∏—Ç–∞—Ä–Ω—ã–º –Ω–∞—É–∫–∞–º. –¢—Ä–µ—Ö—ä—è–∑—ã—á–Ω–æ–µ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ.',
    programs: ['Medicine', 'Engineering', 'Philology', 'Economics', 'Law'],
    achievements: ['–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –≤—É–∑', '–°–∏–ª—å–Ω–∞—è –º–µ–¥–∏—Ü–∏–Ω–∞', '–û–±–º–µ–Ω—ã —Å 50+ —Å—Ç—Ä–∞–Ω–∞–º–∏'],
    contacts: { phone: '+7 (727) 269-63-26', email: 'admission@sdu.edu.kz' }
  },
  {
    id: 'iitu',
    shortName: '–ú–£–ò–¢',
    name: 'International IT University',
    nameRu: '–ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã—Ö –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–π',
    rating: 4.4,
    worldRank: 801,
    city: '–ê–ª–º–∞—Ç—ã',
    founded: 2009,
    students: 2500,
    type: 'state',
    tuition: '1,600,000 - 2,000,000 ‚Ç∏/–≥–æ–¥',
    website: 'https://iitu.edu.kz',
    description: '–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –≤ –ê–ª–º–∞—Ç—ã. –ü–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ —Å Kaspersky, EPAM, Yandex. 98% –≤—ã–ø—É—Å–∫–Ω–∏–∫–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ IT-–∏–Ω–¥—É—Å—Ç—Ä–∏–∏.',
    programs: ['Software Engineering', 'Data Science', 'Cybersecurity', 'AI'],
    achievements: ['–¢–æ–ø-3 IT –≤—É–∑ –†–ö', '–ü–∞—Ä—Ç–Ω–µ—Ä Kaspersky/EPAM', '98% –≤ IT-–∏–Ω–¥—É—Å—Ç—Ä–∏–∏'],
    contacts: { phone: '+7 (727) 330-09-00', email: 'info@iitu.edu.kz' }
  },
  {
    id: 'enu',
    shortName: '–ï–ù–£',
    name: 'L.N. Gumilyov Eurasian National University',
    nameRu: '–ï–ù–£ –∏–º. –õ.–ù. –ì—É–º–∏–ª–µ–≤–∞',
    rating: 4.5,
    worldRank: 501,
    city: '–ê—Å—Ç–∞–Ω–∞',
    founded: 1996,
    students: 16000,
    type: 'state',
    tuition: '550,000 - 1,200,000 ‚Ç∏/–≥–æ–¥',
    website: 'https://enu.kz',
    description: '–ö—Ä—É–ø–Ω–µ–π—à–∏–π –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç —Å—Ç–æ–ª–∏—Ü—ã. 80+ –ø—Ä–æ–≥—Ä–∞–º–º –æ–±—É—á–µ–Ω–∏—è. –°–∏–ª—å–Ω–∞—è –Ω–∞—É—á–Ω–∞—è —à–∫–æ–ª–∞ –∏ —Ñ–∏–ª–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.',
    programs: ['–§–∏–ª–æ–ª–æ–≥–∏—è', '–ò—Å—Ç–æ—Ä–∏—è', '–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞', '–≠–∫–æ–Ω–æ–º–∏–∫–∞', '–ü—Ä–∞–≤–æ'],
    achievements: ['–ö—Ä—É–ø–Ω–µ–π—à–∏–π –≤—É–∑ —Å—Ç–æ–ª–∏—Ü—ã', '80+ –ø—Ä–æ–≥—Ä–∞–º–º', '–ù–∞—É—á–Ω–∞—è —à–∫–æ–ª–∞'],
    contacts: { phone: '+7 (7172) 70-95-00', email: 'rector@enu.kz' }
  }
];

// –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
const bot = new TelegramBot(BOT_TOKEN, { 
  polling: {
    interval: 300,
    autoStart: true,
    params: {
      timeout: 10
    }
  }
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ polling
bot.on('polling_error', (error) => {
  console.error('Polling error:', error.code, error.message);
});

bot.on('error', (error) => {
  console.error('Bot error:', error);
});

// AI —Ñ—É–Ω–∫—Ü–∏—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ fallback
async function getAIResponse(userMessage, context = '') {
  const fullPrompt = `–¢—ã AI-–ø–æ–º–æ—â–Ω–∏–∫ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã KZ UniVerse - –µ–¥–∏–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ.

–ü–û–õ–ù–ê–Ø –ë–ê–ó–ê –î–ê–ù–ù–´–• –£–ù–ò–í–ï–†–°–ò–¢–ï–¢–û–í:
${UNIVERSITIES_DB.map(u => `
üìç ${u.shortName} (${u.name})
   –ì–æ—Ä–æ–¥: ${u.city} | –†–µ–π—Ç–∏–Ω–≥: ${u.rating}/5.0 ${u.worldRank ? `| –ú–∏—Ä–æ–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥: ${u.worldRank}` : ''}
   –¢–∏–ø: ${u.type === 'national' ? '–ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π' : u.type === 'state' ? '–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–π' : '–ß–∞—Å—Ç–Ω—ã–π'}
   –°—Ç–æ–∏–º–æ—Å—Ç—å: ${u.tuition}
   –°—Ç—É–¥–µ–Ω—Ç–æ–≤: ${u.students}
   –û—Å–Ω–æ–≤–∞–Ω: ${u.founded}
   –û–ø–∏—Å–∞–Ω–∏–µ: ${u.description}
   –ü—Ä–æ–≥—Ä–∞–º–º—ã: ${u.programs.join(', ')}
   –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è: ${u.achievements.join(', ')}
   –°–∞–π—Ç: ${u.website}
`).join('\n')}

${context}

–í–û–ü–†–û–° –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: ${userMessage}

–ò–ù–°–¢–†–£–ö–¶–ò–ò:
1. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
2. –ò—Å–ø–æ–ª—å–∑—É–π –ö–û–ù–ö–†–ï–¢–ù–´–ï –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã –≤—ã—à–µ
3. –ë—É–¥—å –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º
4. –î–∞–≤–∞–π –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ —Å —Ü–∏—Ñ—Ä–∞–º–∏
5. –§–æ—Ä–º–∞—Ç–∏—Ä—É–π –æ—Ç–≤–µ—Ç —Å —ç–º–æ–¥–∑–∏
6. –ï—Å–ª–∏ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç –ø—Ä–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤—É–∑ - –¥–∞–π –ø–æ–ª–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
7. –°—Ä–∞–≤–Ω–∏–≤–∞–π —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –µ—Å–ª–∏ –ø—Ä–æ—Å—è—Ç
8. –†–µ–∫–æ–º–µ–Ω–¥—É–π –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã

–û–¢–í–ï–¢:`;

  // –ü–æ–ø—ã—Ç–∫–∞ 1: Gemini API
  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${GEMINI_API_KEY}`,
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          contents: [{ parts: [{ text: fullPrompt }] }],
          generationConfig: {
            temperature: 0.7,
            maxOutputTokens: 1024
          }
        })
      }
    );

    if (response.ok) {
      const data = await response.json();
      const text = data.candidates?.[0]?.content?.parts?.[0]?.text;
      if (text) {
        console.log('‚úÖ Gemini API —É—Å–ø–µ—à–Ω–æ');
        return text;
      }
    }
    console.log('‚ö†Ô∏è Gemini API –Ω–µ –¥–∞–ª –æ—Ç–≤–µ—Ç, –ø—Ä–æ–±—É–µ–º fallback...');
  } catch (error) {
    console.error('‚ùå Gemini error:', error.message);
  }

  // –ü–æ–ø—ã—Ç–∫–∞ 2: –õ–æ–∫–∞–ª—å–Ω–∞—è —É–º–Ω–∞—è –ª–æ–≥–∏–∫–∞
  return getSmartLocalResponse(userMessage);
}

// –£–º–Ω–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
function getSmartLocalResponse(message) {
  const lower = message.toLowerCase();
  
  // –ü–æ–∏—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞
  for (const uni of UNIVERSITIES_DB) {
    if (lower.includes(uni.shortName.toLowerCase()) || 
        lower.includes(uni.name.toLowerCase()) ||
        lower.includes(uni.nameRu.toLowerCase())) {
      return `üèõÔ∏è *${uni.name}* (${uni.shortName})
${uni.nameRu}

üìç –ì–æ—Ä–æ–¥: ${uni.city}
‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${uni.rating}/5.0
${uni.worldRank ? `üåç –ú–∏—Ä–æ–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥: ${uni.worldRank}` : ''}
üìÖ –û—Å–Ω–æ–≤–∞–Ω: ${uni.founded}
üë• –°—Ç—É–¥–µ–Ω—Ç–æ–≤: ${uni.students.toLocaleString()}
üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: ${uni.tuition}

üìù *–û–ø–∏—Å–∞–Ω–∏–µ:*
${uni.description}

üéì *–ü—Ä–æ–≥—Ä–∞–º–º—ã:*
${uni.programs.map(p => `‚Ä¢ ${p}`).join('\n')}

üèÜ *–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:*
${uni.achievements.map(a => `‚úÖ ${a}`).join('\n')}

üìû *–ö–æ–Ω—Ç–∞–∫—Ç—ã:*
üì± ${uni.contacts.phone}
üìß ${uni.contacts.email}
üåê ${uni.website}`;
    }
  }

  // IT –ø—Ä–æ–≥—Ä–∞–º–º—ã
  if (lower.includes('it') || lower.includes('–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ') || lower.includes('–∫–æ–º–ø—å—é—Ç–µ—Ä') || lower.includes('–∞–π—Ç–∏')) {
    const itUnis = UNIVERSITIES_DB.filter(u => 
      u.programs.some(p => p.toLowerCase().includes('it') || 
                          p.toLowerCase().includes('computer') || 
                          p.toLowerCase().includes('software') ||
                          p.toLowerCase().includes('ai') ||
                          p.toLowerCase().includes('data'))
    );
    return `üíª *–õ—É—á—à–∏–µ IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞:*

${itUnis.slice(0, 5).map((u, i) => `${i+1}. *${u.shortName}* - ${u.name}
   üìç ${u.city} | ‚≠ê ${u.rating}/5.0
   üí∞ ${u.tuition}
   üéì ${u.programs.filter(p => p.toLowerCase().includes('it') || p.toLowerCase().includes('ai') || p.toLowerCase().includes('software') || p.toLowerCase().includes('data')).join(', ')}
`).join('\n')}

üí° *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:* –î–ª—è IT-—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π –ª—É—á—à–∏–π –≤—ã–±–æ—Ä - AITU (—Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IT-–≤—É–∑) –∏–ª–∏ NU (–º–∏—Ä–æ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å).`;
  }

  // –ë–∏–∑–Ω–µ—Å –ø—Ä–æ–≥—Ä–∞–º–º—ã
  if (lower.includes('–±–∏–∑–Ω–µ—Å') || lower.includes('—ç–∫–æ–Ω–æ–º–∏–∫–∞') || lower.includes('—Ñ–∏–Ω–∞–Ω—Å') || lower.includes('–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç')) {
    return `üíº *–õ—É—á—à–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ–≥—Ä–∞–º–º—ã:*

1. *KIMEP* - –õ—É—á—à–∞—è –±–∏–∑–Ω–µ—Å-—à–∫–æ–ª–∞ –¶–ê —Å AACSB –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–µ–π
   üí∞ 2.2-3.5M‚Ç∏/–≥–æ–¥ | üìç –ê–ª–º–∞—Ç—ã

2. *NU Graduate School of Business* - –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
   üí∞ $7,000-9,000/–≥–æ–¥ | üìç –ê—Å—Ç–∞–Ω–∞

3. *–ö–ë–¢–£* - –≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏ –±–∏–∑–Ω–µ—Å —Å –±—Ä–∏—Ç–∞–Ω—Å–∫–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏
   üí∞ 1.5-2.5M‚Ç∏/–≥–æ–¥ | üìç –ê–ª–º–∞—Ç—ã

üí° *–°–æ–≤–µ—Ç:* KIMEP - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—É–∑ –≤ –¶–ê —Å –ø—Ä–µ—Å—Ç–∏–∂–Ω–æ–π –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–µ–π AACSB!`;
  }

  // –ì—Ä–∞–Ω—Ç—ã
  if (lower.includes('–≥—Ä–∞–Ω—Ç') || lower.includes('—Å—Ç–∏–ø–µ–Ω–¥–∏') || lower.includes('–±–µ—Å–ø–ª–∞—Ç–Ω–æ')) {
    return `üéì *–ì—Ä–∞–Ω—Ç—ã –∏ —Å—Ç–∏–ø–µ–Ω–¥–∏–∏:*

üìã *–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω—Ç—ã:*
‚Ä¢ –í—ã–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ï–ù–¢
‚Ä¢ –ü–æ–∫—Ä—ã–≤–∞—é—Ç 100% —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è
‚Ä¢ –ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: 110-130 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏)

üèõÔ∏è *–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å–∫–∏–µ –≥—Ä–∞–Ω—Ç—ã:*
‚Ä¢ *NU* - –ø–æ–ª–Ω—ã–µ –≥—Ä–∞–Ω—Ç—ã –¥–ª—è —Ç–æ–ø-–∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤
‚Ä¢ *AITU* - –≥—Ä–∞–Ω—Ç—ã –¥–æ 100% –¥–ª—è IT-—Ç–∞–ª–∞–Ω—Ç–æ–≤
‚Ä¢ *KIMEP* - —Å—Ç–∏–ø–µ–Ω–¥–∏–∏ –∑–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å

üí∞ *–°—Ç–∏–ø–µ–Ω–¥–∏–∏:*
‚Ä¢ –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è: 36,000‚Ç∏/–º–µ—Å
‚Ä¢ NU: –¥–æ 100,000‚Ç∏/–º–µ—Å
‚Ä¢ –ó–∞ –æ—Ç–ª–∏—á–Ω—É—é —É—á–µ–±—É: +20-50%

üí° *–°–æ–≤–µ—Ç:* –ù–∞–±–∏—Ä–∞–π—Ç–µ 120+ –±–∞–ª–ª–æ–≤ –ï–ù–¢ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≥—Ä–∞–Ω—Ç–∞!`;
  }

  // –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
  if (lower.includes('—Å—Ä–∞–≤–Ω') || lower.includes('–ª—É—á—à') || lower.includes('–≤—ã–±–æ—Ä')) {
    return `üìä *–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–æ–ø-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤:*

| –£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç | –†–µ–π—Ç–∏–Ω–≥ | –ì–æ—Ä–æ–¥ | –°—Ç–æ–∏–º–æ—Å—Ç—å |
|-------------|---------|-------|-----------|
| NU          | 4.9 ‚≠ê  | –ê—Å—Ç–∞–Ω–∞ | $7-9K    |
| –ö–∞–∑–ù–£       | 4.7 ‚≠ê  | –ê–ª–º–∞—Ç—ã | 0.6-1.8M‚Ç∏|
| AITU        | 4.6 ‚≠ê  | –ê—Å—Ç–∞–Ω–∞ | 1.8-2.2M‚Ç∏|
| KIMEP       | 4.6 ‚≠ê  | –ê–ª–º–∞—Ç—ã | 2.2-3.5M‚Ç∏|
| –ö–ë–¢–£        | 4.5 ‚≠ê  | –ê–ª–º–∞—Ç—ã | 1.5-2.5M‚Ç∏|

üéØ *–ü–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º:*
‚Ä¢ IT: AITU, –ú–£–ò–¢, NU
‚Ä¢ –ë–∏–∑–Ω–µ—Å: KIMEP, NU
‚Ä¢ –ò–Ω–∂–µ–Ω–µ—Ä–∏—è: –ö–ë–¢–£, –ö–∞–∑–ù–£
‚Ä¢ –ú–µ–¥–∏—Ü–∏–Ω–∞: SDU, NU

–•–æ—Ç–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ? –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤—É–∑–æ–≤!`;
  }

  // –ì–æ—Ä–æ–¥ –ê—Å—Ç–∞–Ω–∞
  if (lower.includes('–∞—Å—Ç–∞–Ω–∞') || lower.includes('–Ω—É—Ä-—Å—É–ª—Ç–∞–Ω')) {
    const astanaUnis = UNIVERSITIES_DB.filter(u => u.city === '–ê—Å—Ç–∞–Ω–∞');
    return `üèôÔ∏è *–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –≤ –ê—Å—Ç–∞–Ω–µ:*

${astanaUnis.map((u, i) => `${i+1}. *${u.shortName}* - ${u.name}
   ‚≠ê ${u.rating}/5.0 | üí∞ ${u.tuition}
   ${u.description.substring(0, 100)}...
`).join('\n')}

üí° –í —Å—Ç–æ–ª–∏—Ü–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã –≤–µ–¥—É—â–∏–µ –≤—É–∑—ã —Å—Ç—Ä–∞–Ω—ã, –≤–∫–ª—é—á–∞—è Nazarbayev University!`;
  }

  // –ì–æ—Ä–æ–¥ –ê–ª–º–∞—Ç—ã
  if (lower.includes('–∞–ª–º–∞—Ç—ã') || lower.includes('–∞–ª–º–∞-–∞—Ç–∞')) {
    const almatyUnis = UNIVERSITIES_DB.filter(u => u.city === '–ê–ª–º–∞—Ç—ã');
    return `üèôÔ∏è *–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –≤ –ê–ª–º–∞—Ç—ã:*

${almatyUnis.map((u, i) => `${i+1}. *${u.shortName}* - ${u.name}
   ‚≠ê ${u.rating}/5.0 | üí∞ ${u.tuition}
   ${u.description.substring(0, 100)}...
`).join('\n')}

üí° –ê–ª–º–∞—Ç—ã - —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∞—è —Å—Ç–æ–ª–∏—Ü–∞ —Å –±–æ–≥–∞—Ç—ã–º –≤—ã–±–æ—Ä–æ–º –≤—É–∑–æ–≤!`;
  }

  // –ü–æ—Å—Ç—É–ø–ª–µ–Ω–∏–µ
  if (lower.includes('–ø–æ—Å—Ç—É–ø') || lower.includes('–¥–æ–∫—É–º–µ–Ω—Ç') || lower.includes('–µ–Ω—Ç')) {
    return `üìù *–ü—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è:*

1Ô∏è‚É£ *–°–¥–∞—Ç—å –ï–ù–¢* (–∏—é–Ω—å-–∏—é–ª—å)
   ‚Ä¢ –ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: 50-130 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—É–∑–∞)
   ‚Ä¢ –î–ª—è –≥—Ä–∞–Ω—Ç–æ–≤: 110+

2Ô∏è‚É£ *–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã:*
   ‚Ä¢ –ê—Ç—Ç–µ—Å—Ç–∞—Ç
   ‚Ä¢ –£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏
   ‚Ä¢ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ 3x4
   ‚Ä¢ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ï–ù–¢

3Ô∏è‚É£ *–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ:*
   ‚Ä¢ –û–Ω–ª–∞–π–Ω –∏–ª–∏ –ª–∏—á–Ω–æ
   ‚Ä¢ –î–µ–¥–ª–∞–π–Ω: 10-20 –∞–≤–≥—É—Å—Ç–∞

4Ô∏è‚É£ *–ü—Ä–æ–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ* (–¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤—É–∑–æ–≤)

5Ô∏è‚É£ *–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã* (–∫–æ–Ω–µ—Ü –∞–≤–≥—É—Å—Ç–∞)

üìÖ *–í–∞–∂–Ω—ã–µ –¥–∞—Ç—ã:*
‚Ä¢ –ï–ù–¢: –∏—é–Ω—å-–∏—é–ª—å
‚Ä¢ –ü—Ä–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: 1 –∏—é–ª—è - 20 –∞–≤–≥—É—Å—Ç–∞
‚Ä¢ –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ: 25 –∞–≤–≥—É—Å—Ç–∞`;
  }

  // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
  return `üëã –ü—Ä–∏–≤–µ—Ç! –Ø AI-–ø–æ–º–æ—â–Ω–∏–∫ KZ UniVerse.

üéì –Ø –º–æ–≥—É –ø–æ–º–æ—á—å —Å:
‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞—Ö –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞
‚Ä¢ –í—ã–±–æ—Ä–æ–º –ø—Ä–æ–≥—Ä–∞–º–º—ã –æ–±—É—á–µ–Ω–∏—è
‚Ä¢ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ–º –≤—É–∑–æ–≤
‚Ä¢ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≥—Ä–∞–Ω—Ç–∞—Ö –∏ —Å—Ç–∏–ø–µ–Ω–¥–∏—è—Ö
‚Ä¢ –ü—Ä–æ—Ü–µ—Å—Å–æ–º –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è

üìù *–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:*
‚Ä¢ "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ Nazarbayev University"
‚Ä¢ "–ö–∞–∫–∏–µ IT —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –≤ –ê–ª–º–∞—Ç—ã?"
‚Ä¢ "–°—Ä–∞–≤–Ω–∏ AITU –∏ –ö–ë–¢–£"
‚Ä¢ "–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –≥—Ä–∞–Ω—Ç?"

–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å! üòä`;
}

// –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
function getMainMenu() {
  return {
    reply_markup: {
      keyboard: [
        [{ text: 'üèõÔ∏è –í—Å–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã' }, { text: 'üèÜ –¢–æ–ø-5 –≤—É–∑–æ–≤' }],
        [{ text: 'üíª IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã' }, { text: 'üíº –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ–≥—Ä–∞–º–º—ã' }],
        [{ text: 'üí∞ –ì—Ä–∞–Ω—Ç—ã –∏ —Å—Ç–∏–ø–µ–Ω–¥–∏–∏' }, { text: 'üìä –°—Ä–∞–≤–Ω–∏—Ç—å –≤—É–∑—ã' }],
        [{ text: 'üìù –ü—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è' }, { text: 'üåê –í–µ–±-–≤–µ—Ä—Å–∏—è' }],
        [{ text: '‚ùì –ü–æ–º–æ—â—å' }]
      ],
      resize_keyboard: true,
      one_time_keyboard: false
    }
  };
}

// –ö–æ–º–∞–Ω–¥–∞ /start
bot.onText(/\/start/, async (msg) => {
  const chatId = msg.chat.id;
  const firstName = msg.from.first_name || '–¥—Ä—É–≥';
  
  await bot.sendMessage(chatId, `üëã –ü—Ä–∏–≤–µ—Ç, ${firstName}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ *KZ UniVerse Bot*!

üéì –Ø —Ç–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π AI-–ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –≤—ã–±–æ—Ä—É —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ.

*–ß—Ç–æ —è —É–º–µ—é:*
üìö –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ 15+ –≤–µ–¥—É—â–∏—Ö —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞—Ö –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞
üìä –£–º–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—É–∑–æ–≤ –ø–æ —Ä–µ–π—Ç–∏–Ω–≥–∞–º, —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞–º
üí∞ –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≥—Ä–∞–Ω—Ç–∞—Ö, —Å—Ç–∏–ø–µ–Ω–¥–∏—è—Ö –∏ –ª—å–≥–æ—Ç–∞—Ö
üéØ –†–∞—Å—á–µ—Ç —à–∞–Ω—Å–æ–≤ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å —É—á–µ—Ç–æ–º –≤–∞—à–∏—Ö –±–∞–ª–ª–æ–≤
üí¨ –û—Ç–≤–µ—Ç—ã –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏ –≤ –†–ö
üîç –ü–æ–∏—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º –ø–æ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º –∏ –≥–æ—Ä–æ–¥–∞–º
üìà –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–∞—à–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–æ–≤

*–ò—Å–ø–æ–ª—å–∑—É–π –º–µ–Ω—é –Ω–∏–∂–µ –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å!* üòä

üåê *–í–µ–±-–≤–µ—Ä—Å–∏—è:* ${API_URL}`, { 
    parse_mode: 'Markdown',
    ...getMainMenu()
  });
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –º–µ–Ω—é
bot.on('message', async (msg) => {
  const chatId = msg.chat.id;
  const text = msg.text;
  
  // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—ã (–æ–Ω–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ)
  if (text && text.startsWith('/')) return;
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
  if (text === 'üèõÔ∏è –í—Å–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã') {
    let response = 'üèõÔ∏è *–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞:*\n\n';
    UNIVERSITIES_DB.forEach((uni, index) => {
      const typeEmoji = uni.type === 'national' ? 'üèõÔ∏è' : uni.type === 'state' ? 'üè´' : 'üíº';
      response += `${index + 1}. ${typeEmoji} *${uni.shortName}* - ${uni.name}\n`;
      response += `   üìç ${uni.city} | ‚≠ê ${uni.rating}/5.0\n`;
      response += `   üí∞ ${uni.tuition}\n\n`;
    });
    response += `\nüìù –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏!`;
    await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  if (text === 'üèÜ –¢–æ–ø-5 –≤—É–∑–æ–≤') {
    const top5 = [...UNIVERSITIES_DB].sort((a, b) => b.rating - a.rating).slice(0, 5);
    let response = 'üèÜ *–¢–æ–ø-5 —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞:*\n\n';
    top5.forEach((uni, index) => {
      response += `${['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'][index]} *${uni.shortName}* - ${uni.name}\n`;
      response += `   ‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${uni.rating}/5.0\n`;
      response += `   üìç ${uni.city}\n`;
      response += `   üí∞ ${uni.tuition}\n`;
      if (uni.worldRank) response += `   üåç –ú–∏—Ä–æ–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥: ${uni.worldRank}\n`;
      response += '\n';
    });
    await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  if (text === 'üíª IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã') {
    const itUnis = UNIVERSITIES_DB.filter(u => 
      u.programs.some(p => 
        p.toLowerCase().includes('it') || 
        p.toLowerCase().includes('computer') || 
        p.toLowerCase().includes('software') ||
        p.toLowerCase().includes('ai') ||
        p.toLowerCase().includes('data')
      )
    );
    let response = 'üíª *IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞:*\n\n';
    itUnis.forEach((uni, index) => {
      response += `${index + 1}. *${uni.shortName}* - ${uni.name}\n`;
      response += `   üìç ${uni.city} | ‚≠ê ${uni.rating}/5.0\n`;
      response += `   üí∞ ${uni.tuition}\n`;
      response += `   üéì ${uni.programs.filter(p => p.toLowerCase().includes('it') || p.toLowerCase().includes('ai') || p.toLowerCase().includes('software') || p.toLowerCase().includes('data') || p.toLowerCase().includes('computer')).join(', ')}\n\n`;
    });
    response += `\nüí° *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:* AITU - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IT-–≤—É–∑ —Å –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ–º Google –∏ Microsoft!`;
    await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  if (text === 'üíº –ë–∏–∑–Ω–µ—Å-–ø—Ä–æ–≥—Ä–∞–º–º—ã') {
    const response = `üíº *–õ—É—á—à–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ–≥—Ä–∞–º–º—ã:*

1. *KIMEP* - –õ—É—á—à–∞—è –±–∏–∑–Ω–µ—Å-—à–∫–æ–ª–∞ –¶–ê —Å AACSB –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–µ–π
   üí∞ 2.2-3.5M‚Ç∏/–≥–æ–¥ | üìç –ê–ª–º–∞—Ç—ã

2. *NU Graduate School of Business* - –ú–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
   üí∞ $7,000-9,000/–≥–æ–¥ | üìç –ê—Å—Ç–∞–Ω–∞

3. *–ö–ë–¢–£* - –≠–∫–æ–Ω–æ–º–∏–∫–∞ –∏ –±–∏–∑–Ω–µ—Å —Å –±—Ä–∏—Ç–∞–Ω—Å–∫–∏–º–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏
   üí∞ 1.5-2.5M‚Ç∏/–≥–æ–¥ | üìç –ê–ª–º–∞—Ç—ã

üí° *–°–æ–≤–µ—Ç:* KIMEP - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤—É–∑ –≤ –¶–ê —Å –ø—Ä–µ—Å—Ç–∏–∂–Ω–æ–π –∞–∫–∫—Ä–µ–¥–∏—Ç–∞—Ü–∏–µ–π AACSB!`;
    await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  if (text === 'üí∞ –ì—Ä–∞–Ω—Ç—ã –∏ —Å—Ç–∏–ø–µ–Ω–¥–∏–∏') {
    const response = `üéì *–ì—Ä–∞–Ω—Ç—ã –∏ —Å—Ç–∏–ø–µ–Ω–¥–∏–∏ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ:*

üìã *–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω—Ç—ã:*
‚Ä¢ –í—ã–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ï–ù–¢
‚Ä¢ –ü–æ–∫—Ä—ã–≤–∞—é—Ç 100% —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è
‚Ä¢ –ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: 110-130 –±–∞–ª–ª–æ–≤

üèõÔ∏è *–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å–∫–∏–µ –≥—Ä–∞–Ω—Ç—ã:*
‚Ä¢ *NU* - –ø–æ–ª–Ω—ã–µ –≥—Ä–∞–Ω—Ç—ã –¥–ª—è —Ç–æ–ø-–∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤
‚Ä¢ *AITU* - –≥—Ä–∞–Ω—Ç—ã –¥–æ 100% –¥–ª—è IT-—Ç–∞–ª–∞–Ω—Ç–æ–≤
‚Ä¢ *KIMEP* - —Å—Ç–∏–ø–µ–Ω–¥–∏–∏ –∑–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –¥–æ 50%
‚Ä¢ *–ö–ë–¢–£* - –≥—Ä–∞–Ω—Ç—ã –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤

üí∞ *–†–∞–∑–º–µ—Ä —Å—Ç–∏–ø–µ–Ω–¥–∏–π:*
‚Ä¢ –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è: 36,000‚Ç∏/–º–µ—Å
‚Ä¢ NU: –¥–æ 100,000‚Ç∏/–º–µ—Å
‚Ä¢ –ó–∞ –æ—Ç–ª–∏—á–Ω—É—é —É—á–µ–±—É: +20-50%

üìù *–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –≥—Ä–∞–Ω—Ç:*
1. –ù–∞–±—Ä–∞—Ç—å –≤—ã—Å–æ–∫–∏–π –±–∞–ª–ª –ï–ù–¢ (120+)
2. –ü–æ–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
3. –ü—Ä–æ–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

üí° *–°–æ–≤–µ—Ç:* –ù–∞—á–Ω–∏—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –ï–ù–¢ –∑–∞—Ä–∞–Ω–µ–µ!`;
    await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  if (text === 'üìä –°—Ä–∞–≤–Ω–∏—Ç—å –≤—É–∑—ã') {
    const response = `üìä *–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤:*

–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è 2-3 —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

*–ü—Ä–∏–º–µ—Ä:*
"–°—Ä–∞–≤–Ω–∏ NU –∏ AITU"
"–ö–ë–¢–£ vs KIMEP"
"NU, AITU, –ö–ë–¢–£"

*–î–æ—Å—Ç—É–ø–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã:*
${UNIVERSITIES_DB.map(u => `‚Ä¢ ${u.shortName}`).join('\n')}`;
    await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  if (text === 'üìù –ü—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è') {
    const response = `üìù *–ü—Ä–æ—Ü–µ—Å—Å –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è:*

1Ô∏è‚É£ *–°–¥–∞—Ç—å –ï–ù–¢* (–∏—é–Ω—å-–∏—é–ª—å)
   ‚Ä¢ –ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: 50-130 (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –≤—É–∑–∞)
   ‚Ä¢ –î–ª—è –≥—Ä–∞–Ω—Ç–æ–≤: 110+

2Ô∏è‚É£ *–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã:*
   ‚Ä¢ –ê—Ç—Ç–µ—Å—Ç–∞—Ç
   ‚Ä¢ –£–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏
   ‚Ä¢ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ 3x4
   ‚Ä¢ –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –ï–ù–¢

3Ô∏è‚É£ *–ü–æ–¥–∞—Ç—å –∑–∞—è–≤–ª–µ–Ω–∏–µ:*
   ‚Ä¢ –û–Ω–ª–∞–π–Ω –∏–ª–∏ –ª–∏—á–Ω–æ
   ‚Ä¢ –î–µ–¥–ª–∞–π–Ω: 10-20 –∞–≤–≥—É—Å—Ç–∞

4Ô∏è‚É£ *–ü—Ä–æ–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ* (–¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤—É–∑–æ–≤)

5Ô∏è‚É£ *–ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã* (–∫–æ–Ω–µ—Ü –∞–≤–≥—É—Å—Ç–∞)

üìÖ *–í–∞–∂–Ω—ã–µ –¥–∞—Ç—ã:*
‚Ä¢ –ï–ù–¢: –∏—é–Ω—å-–∏—é–ª—å
‚Ä¢ –ü—Ä–∏–µ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: 1 –∏—é–ª—è - 20 –∞–≤–≥—É—Å—Ç–∞
‚Ä¢ –ó–∞—á–∏—Å–ª–µ–Ω–∏–µ: 25 –∞–≤–≥—É—Å—Ç–∞`;
    await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  if (text === 'üåê –í–µ–±-–≤–µ—Ä—Å–∏—è') {
    await bot.sendMessage(chatId, `üåê *–í–µ–±-–≤–µ—Ä—Å–∏—è KZ UniVerse:*

${API_URL}

–ù–∞ —Å–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ:
‚Ä¢ –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞—Ö
‚Ä¢ 3D-—Ç—É—Ä—ã –ø–æ –∫–∞–º–ø—É—Å–∞–º
‚Ä¢ –†–∞—Å—á–µ—Ç —à–∞–Ω—Å–æ–≤ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è —Å AI
‚Ä¢ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤
‚Ä¢ –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å`, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  if (text === '‚ùì –ü–æ–º–æ—â—å') {
    const response = `üìö *–°–ø—Ä–∞–≤–∫–∞ KZ UniVerse Bot:*

*–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—É–∑–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚Ä¢ –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
‚Ä¢ –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å—Ä–∞–≤–Ω–∏—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã

*–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:*
‚Ä¢ "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ Nazarbayev University"
‚Ä¢ "–ö–∞–∫–∏–µ IT –≤—É–∑—ã –≤ –ê—Å—Ç–∞–Ω–µ?"
‚Ä¢ "–ö–∞–∫ –ø–æ—Å—Ç—É–ø–∏—Ç—å –≤ AITU?"
‚Ä¢ "–°—Ä–∞–≤–Ω–∏ –ö–ë–¢–£ –∏ KIMEP"

üåê *–í–µ–±-–≤–µ—Ä—Å–∏—è:* ${API_URL}

*–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:*
–í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ:
‚Ä¢ –ù–æ–≤—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—è—Ö
‚Ä¢ –í–∞–∂–Ω—ã—Ö –¥–∞—Ç–∞—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
‚Ä¢ –ì—Ä–∞–Ω—Ç–∞—Ö –∏ —Å—Ç–∏–ø–µ–Ω–¥–∏—è—Ö
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤`;
    await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    return;
  }
  
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—ã—á–Ω—ã—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (AI)
  try {
    await bot.sendChatAction(chatId, 'typing');
    const response = await getAIResponse(text);
    
    if (response.length > 4000) {
      const chunks = response.match(/.{1,4000}/gs) || [];
      for (const chunk of chunks) {
        await bot.sendMessage(chatId, chunk, { parse_mode: 'Markdown', ...getMainMenu() });
      }
    } else {
      await bot.sendMessage(chatId, response, { parse_mode: 'Markdown', ...getMainMenu() });
    }
  } catch (error) {
    console.error('Message error:', error);
    await bot.sendMessage(chatId, '‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é.', { ...getMainMenu() });
  }
});

// –ö–æ–º–∞–Ω–¥–∞ /universities
bot.onText(/\/universities/, async (msg) => {
  const chatId = msg.chat.id;
  
  let text = 'üèõÔ∏è *–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞:*\n\n';
  UNIVERSITIES_DB.forEach((uni, index) => {
    const typeEmoji = uni.type === 'national' ? 'üèõÔ∏è' : uni.type === 'state' ? 'üè´' : 'üíº';
    text += `${index + 1}. ${typeEmoji} *${uni.shortName}* - ${uni.name}\n`;
    text += `   üìç ${uni.city} | ‚≠ê ${uni.rating}/5.0\n`;
    text += `   üí∞ ${uni.tuition}\n\n`;
  });
  
  text += `\nüìù –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–∞ –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏!`;
  
  await bot.sendMessage(chatId, text, { parse_mode: 'Markdown', ...getMainMenu() });
});

// –ö–æ–º–∞–Ω–¥–∞ /top5
bot.onText(/\/top5/, async (msg) => {
  const chatId = msg.chat.id;
  
  const top5 = [...UNIVERSITIES_DB].sort((a, b) => b.rating - a.rating).slice(0, 5);
  
  let text = 'üèÜ *–¢–æ–ø-5 —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞:*\n\n';
  top5.forEach((uni, index) => {
    text += `${['ü•á', 'ü•à', 'ü•â', '4Ô∏è‚É£', '5Ô∏è‚É£'][index]} *${uni.shortName}* - ${uni.name}\n`;
    text += `   ‚≠ê –†–µ–π—Ç–∏–Ω–≥: ${uni.rating}/5.0\n`;
    text += `   üìç ${uni.city}\n`;
    text += `   üí∞ ${uni.tuition}\n`;
    if (uni.worldRank) text += `   üåç –ú–∏—Ä–æ–≤–æ–π —Ä–µ–π—Ç–∏–Ω–≥: ${uni.worldRank}\n`;
    text += '\n';
  });
  
  await bot.sendMessage(chatId, text, { parse_mode: 'Markdown' });
});

// –ö–æ–º–∞–Ω–¥–∞ /it
bot.onText(/\/it/, async (msg) => {
  const chatId = msg.chat.id;
  
  const itUnis = UNIVERSITIES_DB.filter(u => 
    u.programs.some(p => 
      p.toLowerCase().includes('it') || 
      p.toLowerCase().includes('computer') || 
      p.toLowerCase().includes('software') ||
      p.toLowerCase().includes('ai') ||
      p.toLowerCase().includes('data')
    )
  );
  
  let text = 'üíª *IT-—É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞:*\n\n';
  itUnis.forEach((uni, index) => {
    text += `${index + 1}. *${uni.shortName}* - ${uni.name}\n`;
    text += `   üìç ${uni.city} | ‚≠ê ${uni.rating}/5.0\n`;
    text += `   üí∞ ${uni.tuition}\n`;
    text += `   üéì ${uni.programs.filter(p => p.toLowerCase().includes('it') || p.toLowerCase().includes('ai') || p.toLowerCase().includes('software') || p.toLowerCase().includes('data') || p.toLowerCase().includes('computer')).join(', ')}\n\n`;
  });
  
  text += `\nüí° *–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:* AITU - —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π IT-–≤—É–∑ —Å –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ–º Google –∏ Microsoft!`;
  
  await bot.sendMessage(chatId, text, { parse_mode: 'Markdown' });
});

// –ö–æ–º–∞–Ω–¥–∞ /grants
bot.onText(/\/grants/, async (msg) => {
  const chatId = msg.chat.id;
  
  const text = `üéì *–ì—Ä–∞–Ω—Ç—ã –∏ —Å—Ç–∏–ø–µ–Ω–¥–∏–∏ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ:*

üìã *–ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –≥—Ä–∞–Ω—Ç—ã:*
‚Ä¢ –í—ã–¥–µ–ª—è—é—Ç—Å—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ï–ù–¢
‚Ä¢ –ü–æ–∫—Ä—ã–≤–∞—é—Ç 100% —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –æ–±—É—á–µ–Ω–∏—è
‚Ä¢ –ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª: 110-130 –±–∞–ª–ª–æ–≤

üèõÔ∏è *–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Å–∫–∏–µ –≥—Ä–∞–Ω—Ç—ã:*
‚Ä¢ *NU* - –ø–æ–ª–Ω—ã–µ –≥—Ä–∞–Ω—Ç—ã –¥–ª—è —Ç–æ–ø-–∞–±–∏—Ç—É—Ä–∏–µ–Ω—Ç–æ–≤
‚Ä¢ *AITU* - –≥—Ä–∞–Ω—Ç—ã –¥–æ 100% –¥–ª—è IT-—Ç–∞–ª–∞–Ω—Ç–æ–≤
‚Ä¢ *KIMEP* - —Å—Ç–∏–ø–µ–Ω–¥–∏–∏ –∑–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç—å –¥–æ 50%
‚Ä¢ *–ö–ë–¢–£* - –≥—Ä–∞–Ω—Ç—ã –¥–ª—è –∏–Ω–∂–µ–Ω–µ—Ä–æ–≤

üí∞ *–†–∞–∑–º–µ—Ä —Å—Ç–∏–ø–µ–Ω–¥–∏–π:*
‚Ä¢ –ì–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–∞—è: 36,000‚Ç∏/–º–µ—Å
‚Ä¢ NU: –¥–æ 100,000‚Ç∏/–º–µ—Å
‚Ä¢ –ó–∞ –æ—Ç–ª–∏—á–Ω—É—é —É—á–µ–±—É: +20-50%

üìù *–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –≥—Ä–∞–Ω—Ç:*
1. –ù–∞–±—Ä–∞—Ç—å –≤—ã—Å–æ–∫–∏–π –±–∞–ª–ª –ï–ù–¢ (120+)
2. –ü–æ–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞
3. –ü—Ä–æ–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏–µ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)

üí° *–°–æ–≤–µ—Ç:* –ù–∞—á–Ω–∏—Ç–µ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∫ –ï–ù–¢ –∑–∞—Ä–∞–Ω–µ–µ!`;
  
  await bot.sendMessage(chatId, text, { parse_mode: 'Markdown' });
});

// –ö–æ–º–∞–Ω–¥–∞ /compare
bot.onText(/\/compare/, async (msg) => {
  const chatId = msg.chat.id;
  
  const text = `üìä *–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤:*

–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è 2-3 —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–æ–≤ –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

*–ü—Ä–∏–º–µ—Ä:*
"–°—Ä–∞–≤–Ω–∏ NU –∏ AITU"
"–ö–ë–¢–£ vs KIMEP"
"NU, AITU, –ö–ë–¢–£"

*–î–æ—Å—Ç—É–ø–Ω—ã–µ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã:*
${UNIVERSITIES_DB.map(u => `‚Ä¢ ${u.shortName}`).join('\n')}`;
  
  await bot.sendMessage(chatId, text, { parse_mode: 'Markdown' });
});

// –ö–æ–º–∞–Ω–¥–∞ /help
bot.onText(/\/help/, async (msg) => {
  const chatId = msg.chat.id;
  
  const text = `üìö *–°–ø—Ä–∞–≤–∫–∞ KZ UniVerse Bot:*

*–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:*
‚Ä¢ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—é –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤—É–∑–∞ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
‚Ä¢ –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
‚Ä¢ –ü–æ–ø—Ä–æ—Å–∏—Ç–µ —Å—Ä–∞–≤–Ω–∏—Ç—å —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—ã

*–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:*
‚Ä¢ "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ Nazarbayev University"
‚Ä¢ "–ö–∞–∫–∏–µ IT –≤—É–∑—ã –≤ –ê—Å—Ç–∞–Ω–µ?"
‚Ä¢ "–ö–∞–∫ –ø–æ—Å—Ç—É–ø–∏—Ç—å –≤ AITU?"
‚Ä¢ "–°—Ä–∞–≤–Ω–∏ –ö–ë–¢–£ –∏ KIMEP"

üåê *–í–µ–±-–≤–µ—Ä—Å–∏—è:* ${API_URL}

*–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:*
–í—ã –±—É–¥–µ—Ç–µ –ø–æ–ª—É—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ:
‚Ä¢ –ù–æ–≤—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—è—Ö
‚Ä¢ –í–∞–∂–Ω—ã—Ö –¥–∞—Ç–∞—Ö –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
‚Ä¢ –ì—Ä–∞–Ω—Ç–∞—Ö –∏ —Å—Ç–∏–ø–µ–Ω–¥–∏—è—Ö
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤`;
  
  await bot.sendMessage(chatId, text, { parse_mode: 'Markdown', ...getMainMenu() });
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
async function sendNotification(chatId, type, message) {
  const emoji = {
    'grant': 'üí∞',
    'deadline': 'üìÖ',
    'program': 'üéì',
    'ranking': 'üìä',
    'general': 'üîî'
  }[type] || 'üîî';
  
  try {
    await bot.sendMessage(chatId, `${emoji} *–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ KZ UniVerse*\n\n${message}`, {
      parse_mode: 'Markdown',
      ...getMainMenu()
    });
  } catch (error) {
    console.error('Notification error:', error);
  }
}

// –ü—Ä–∏–º–µ—Ä: –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤–∞–∂–Ω—ã—Ö –¥–∞—Ç–∞—Ö (–º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é)
// setInterval(() => {
//   // –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
//   // –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–∞–∂–¥–æ–º—É
// }, 86400000); // –†–∞–∑ –≤ –¥–µ–Ω—å

console.log('ü§ñ KZ UniVerse Telegram Bot –∑–∞–ø—É—â–µ–Ω!');
console.log('üì± –¢–æ–∫–µ–Ω:', BOT_TOKEN.substring(0, 10) + '...');
console.log('üåê API URL:', API_URL);
